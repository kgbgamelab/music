<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Genially Music Editor</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f4f9; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 600px; margin: auto; }
        .track-row { border-bottom: 1px solid #eee; padding: 10px 0; display: flex; justify-content: space-between; align-items: center; }
        input, button { padding: 8px; margin: 5px; border-radius: 5px; border: 1px solid #ccc; }
        button { cursor: pointer; background: #3d36cf; color: white; border: none; }
        button:hover { background: #2b25a1; }
        #resultCode { width: 100%; height: 150px; margin-top: 20px; display: none; }
    </style>
</head>
<body>

<div class="card">
    <h2>üéµ –†–µ–¥–∞–∫—Ç–æ—Ä –º—É–∑—ã–∫–∏ –¥–ª—è Genially</h2>
    <p><small>–î–æ–±–∞–≤—å —Ñ–∞–π–ª—ã, —É–∫–∞–∂–∏ —Å–ª–∞–π–¥—ã –∏ —Å–∫–æ–ø–∏—Ä—É–π –∫–æ–¥.</small></p>
    
    <div id="tracks">
        <div class="input-group">
            <input type="file" id="fileInput" accept="audio/*">
            –û—Ç <input type="number" id="startS" placeholder="1" style="width: 40px;"> 
            –¥–æ <input type="number" id="endS" placeholder="5" style="width: 40px;">
            <button onclick="addTrack()">–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫</button>
        </div>
    </div>

    <div id="trackList"></div>

    <hr>
    <button onclick="generateCode()" style="width: 100%; background: #28a745;">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –¥–ª—è Genially</button>
    <textarea id="resultCode" readonly></textarea>
</div>

<script>
    let playlist = [];

    function addTrack() {
        const file = document.getElementById('fileInput').files[0];
        const start = document.getElementById('startS').value;
        const end = document.getElementById('endS').value;

        if (!file || !start || !end) return alert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è –∏ –≤—ã–±–µ—Ä–∏ —Ñ–∞–π–ª!");

        const reader = new FileReader();
        reader.onload = function(e) {
            playlist.push({
                base64: e.target.result,
                name: file.name,
                start: parseInt(start),
                end: parseInt(end)
            });
            renderList();
        };
        reader.readAsDataURL(file);
    }

    function renderList() {
        const list = document.getElementById('trackList');
        list.innerHTML = playlist.map((t, i) => `
            <div class="track-row">
                <span><b>${t.name}</b> (–°–ª–∞–π–¥—ã ${t.start}-${t.end})</span>
                <button onclick="playlist.splice(${i},1); renderList()" style="background:red">‚ùå</button>
            </div>
        `).join('');
    }

    function generateCode() {
        if (playlist.length === 0) return alert("–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å —Ç—Ä–µ–∫–∏!");
        
        const jsonPlaylist = JSON.stringify(playlist);
        const code = `<div style="display:none;"><audio id="genPlayer" loop></audio></div>
<script>
(function() {
    const playlist = ${jsonPlaylist};
    const player = document.getElementById('genPlayer');
    let currentSrc = "";

    function check() {
        try {
            const h = window.parent.location.hash;
            const m = h.match(/page=(\\d+)/) || h.match(/p=(\\d+)/);
            const s = m ? parseInt(m[1]) : 1;
            const track = playlist.find(t => s >= t.start && s <= t.end);
            if (track && track.base64 !== currentSrc) {
                currentSrc = track.base64;
                player.src = currentSrc;
                player.play().catch(() => {});
            }
        } catch(e) {}
    }
    setInterval(check, 800);
    window.parent.document.addEventListener('click', () => player.play(), {once:true});
})();
<\/script>`;
        
        const res = document.getElementById('resultCode');
        res.value = code;
        res.style.display = 'block';
        res.select();
        alert("–ö–æ–¥ –≥–æ—Ç–æ–≤ –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω! –í—Å—Ç–∞–≤—å –µ–≥–æ –≤ Genially (Insert -> Others)");
    }
</script>

</body>
</html>
